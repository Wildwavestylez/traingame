<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Train Game</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    /* Kontajner pro mapu */
    #mapContainer {
      position: relative;
      width: 100%;
      height: 500px; /* Zmenšení mapy */
    }

    /* Map itself */
    #map {
      width: 100%;
      height: 100%;
    }

    /* Info box for money tracking */
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: rgba(255, 255, 255, 0.7);
      padding: 10px;
      border-radius: 5px;
      font-size: 16px;
      z-index: 1000; /* Ensuring the money info is always on top */
    }

    /* Station and line selection containers */
    #stationSelection, #lineSelection {
      position: absolute;
      top: 10px;
      left: 300px;
      background-color: rgba(255, 255, 255, 0.7);
      padding: 10px;
      border-radius: 5px;
      font-size: 16px;
      display: none;
      z-index: 1000; /* Ensure the selection boxes are above the map */
    }
  </style>
</head>
<body>
  <div id="mapContainer">
    <div id="map"></div> <!-- Mapa -->
  </div>

  <div id="info">Money: $0</div>

  <div id="stationSelection">
    <h3>Select a Station</h3>
    <input type="text" id="stationSearch" placeholder="Start typing a station name..." oninput="filterStations()">
    <div id="suggestions"></div>
  </div>

  <div id="lineSelection">
    <h3>Select a Line</h3>
    <select id="lineSelect"></select>
    <button onclick="selectLine()">Select Line</button>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    // Map initialization
    var map = L.map('map').setView([48.8675378, 21.8248364], 13); // Example: Strážské coordinates

    // Add tile layer (OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Data for lines and stations
    const lines = [
      {
        name: "Trať 192 STRÁŽSKÉ - TREBIŠOV",
        color: "#FFFFFF00",
        category: "A",
        locked: true, // Line is locked initially
        trains: [
          { name: "STRÁŽSKÉ - TREBIŠOV", startingIndex: 0, reverse: false, image: 'https://i.imgur.com/sgF74F8.png', maxSpeed: 600 },
          { name: "STRÁŽSKÉ - TREBIŠOV", startingIndex: 8, reverse: false, image: 'https://i.imgur.com/5V3WrS7.png', maxSpeed: 600 }
        ],
        stops: [
          { name: "Strážské", location: [48.8675378, 21.8248364], locked: true },
          { name: "Nižný Hrabovec", location: [48.8570392, 21.7518606], locked: true },
          { name: "Hencovce", location: [48.8570392, 21.7518606], locked: true },
          { name: "Vranovské Dlhé", location: [48.8695603, 21.7053108], locked: true },
          { name: "Vranov nad Topľou", location: [48.8900675, 21.6740197], locked: true },
          { name: "Komárany", location: [48.9131272, 21.6385608], locked: true },
          { name: "Soľ", location: [48.9319739, 21.6005106], locked: true },
          { name: "Hlinné", location: [48.9529000, 21.5841294], locked: true },
          { name: "Čierne nad Topľou", location: [48.9897806, 21.5694306], locked: true },
          { name: "Bystré", location: [49.0033111, 21.5423933], locked: true }
        ]
      }
    ];

// Money tracking
    var money = 0;
    function increaseMoney(amount) {
      money += amount;
      document.getElementById('info').textContent = 'Money: $' + money;
    }

    // Create a list of all station names for auto-suggest
    const allStations = [];
    lines.forEach(line => {
      line.stops.forEach(stop => {
        allStations.push({ name: stop.name, location: stop.location });
      });
    });

    // Filter stations to remove duplicates based on name and coordinates
    function getUniqueStations() {
      const uniqueStations = [];
      const seen = new Set();

      allStations.forEach(station => {
        const stationKey = `${station.name}-${station.location.join(',')}`;
        if (!seen.has(stationKey)) {
          seen.add(stationKey);
          uniqueStations.push(station);
        }
      });

      return uniqueStations;
    }

    // Filtrování stanic podle vstupu uživatele
    function filterStations() {
      const query = document.getElementById('stationSearch').value.toLowerCase();
      const filteredStations = getUniqueStations().filter(station => station.name.toLowerCase().includes(query));

      // Zobrazí návrhy
      showSuggestions(filteredStations);
    }

    // Zobrazení návrhů
    function showSuggestions(stations) {
      const suggestionsDiv = document.getElementById('suggestions');
      suggestionsDiv.innerHTML = ''; // Clear previous suggestions

      if (stations.length === 0) {
        suggestionsDiv.style.display = 'none'; // Hide if no matches
        return;
      }

      suggestionsDiv.style.display = 'block'; // Show if there are matches
      stations.forEach(station => {
        const div = document.createElement('div');
        div.textContent = station.name;
        div.onclick = () => selectStation(station); // When a station is clicked
        suggestionsDiv.appendChild(div);
      });
    }

    // Vybere stanici
    function selectStation(station) {
      document.getElementById('stationSearch').value = station.name;
      document.getElementById('suggestions').style.display = 'none'; // Hide suggestions
      alert(`You selected: ${station.name}`);

      // Hide the station selection box
      document.getElementById('stationSelection').style.display = 'none';

      // Now load available lines for the selected station
      loadLines(station);
    }

    // Load all lines available from the selected station
    function loadLines(selectedStation) {
      let lineSelect = document.getElementById('lineSelect');
      lineSelect.innerHTML = ''; // Clear previous selections

      // Find the line(s) corresponding to the selected station
      lines.forEach((line, lineIndex) => {
        line.stops.forEach((stop, stopIndex) => {
          if (stop.name === selectedStation.name && stop.location[0] === selectedStation.location[0] && stop.location[1] === selectedStation.location[1]) {
            let option = document.createElement('option');
            option.value = `${lineIndex}-${stopIndex}`;
            option.textContent = line.name;
            lineSelect.appendChild(option);
          }
        });
      });

      document.getElementById('lineSelection').style.display = 'block'; // Show line selection
    }

    function selectLine() {
      const selectedValue = document.getElementById('lineSelect').value;
      const [lineIndex, stopIndex] = selectedValue.split('-').map(Number);
      const selectedLine = lines[lineIndex];
      console.log(`Selected Line: ${selectedLine.name}`);

      // Start the game or simulate the train
      startGame(lineIndex, stopIndex);
    }

    function startGame(lineIndex, stopIndex) {
      const line = lines[lineIndex];
      const startingStation = line.stops[stopIndex];
      const trainMarker = L.marker(startingStation.location).addTo(map);

      increaseMoney(50); // Start with some money
      alert(`Game started! You are at station: ${startingStation.name}`);
    }

    // Initialize the game by showing station selection
    document.getElementById('stationSelection').style.display = 'block';
  </script>
</body>
</html>
