<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Train Game</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    /* Kontajner pro mapu */
    #mapContainer {
      position: relative;
      width: 100%;
      height: 600px;
    }

    /* Map itself */
    #map {
      width: 100%;
      height: 100%;
    }

    /* Info box for money tracking */
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: rgba(255, 255, 255, 0.7);
      padding: 10px;
      border-radius: 5px;
      font-size: 16px;
    }

    
    #stationSelection, #lineSelection {
      position: absolute;
      top: 10px;
      left: 300px;
      background-color: rgba(255, 255, 255, 0.7);
      padding: 10px;
      border-radius: 5px;
      font-size: 16px;
      display: none;
      z-index: 1000; /* Ensure the selection boxes are above the map */
    }
  </style>
</head>
<body>
  <div id="mapContainer">
    <div id="map"></div> <!-- Mapa -->
  </div>

  <div id="info">Money: $0</div>

  <div id="stationSelection">
    <h3>Select a Station</h3>
    <select id="stationSelect"></select>
    <button onclick="selectStation()">Select Station</button>
  </div>

  <div id="lineSelection">
    <h3>Select a Line</h3>
    <select id="lineSelect"></select>
    <button onclick="selectLine()">Select Line</button>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    // Map initialization
    var map = L.map('map').setView([48.8675378, 21.8248364], 13); // Example: Strážské coordinates

    // Add tile layer (OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Data for lines and stations
    const lines = [
      {
        name: "Trať 192 STRÁŽSKÉ - TREBIŠOV",
        color: "#FFFFFF00",
        category: "A",
        locked: true, // Line is locked initially
        trains: [
          { name: "STRÁŽSKÉ - TREBIŠOV", startingIndex: 0, reverse: false, image: 'https://i.imgur.com/sgF74F8.png', maxSpeed: 600 },
          { name: "STRÁŽSKÉ - TREBIŠOV", startingIndex: 8, reverse: false, image: 'https://i.imgur.com/5V3WrS7.png', maxSpeed: 600 }
        ],
        stops: [
          { name: "Strážské", location: [48.8675378, 21.8248364], locked: true, country: "SK",region: "KE", district: "MI",  otherLines: ["Linka123", "Linka568"], },
          { name: "Nižný Hrabovec", location: [48.8570392, 21.7518606], locked: true, country: "SK",region: "KE", district: "VT", },
          { name: "Hencovce", location: [48.8570392, 21.7518606], locked: true, country: "SK",region: "KE", district: "VT", },
          { name: "Vranovské Dlhé", location: [48.8695603, 21.7053108], locked: true, country: "SK",region: "KE", district: "VT", },
          { name: "Vranov nad Topľou", location: [48.8900675, 21.6740197], locked: true, country: "SK",region: "KE", district: "VT", },
          { name: "Komárany", location: [48.9131272, 21.6385608], locked: true, country: "SK",region: "KE", district: "VT", },
          { name: "Soľ", location: [48.9319739, 21.6005106], locked: true, country: "SK",region: "KE", district: "VT", },
          { name: "Hlinné", location: [48.9529000, 21.5841294], locked: true, country: "SK",region: "KE", district: "VT", },
          { name: "Čierne nad Topľou", location: [48.9897806, 21.5694306], locked: true, country: "SK",region: "KE", district: "VT", },
          { name: "Bystré", location: [49.0033111, 21.5423933], locked: true, country: "SK",region: "KE", district: "VT", }
        ]
      }
    ];

 // Function to load regions based on selected country
  function loadRegions() {
    const country = document.getElementById('countrySelect').value;
    const regions = new Set(); // To avoid duplicate regions

    stations.forEach(station => {
      if (station.country === country) {
        regions.add(station.region);
      }
    });

    const regionSelect = document.getElementById('regionSelect');
    regionSelect.innerHTML = "<option value=''>Select Region</option>";
    regions.forEach(region => {
      const option = document.createElement('option');
      option.value = region;
      option.textContent = region;
      regionSelect.appendChild(option);
    });
  }

  // Function to load districts based on selected region
  function loadDistricts() {
    const country = document.getElementById('countrySelect').value;
    const region = document.getElementById('regionSelect').value;
    const districts = new Set(); // To avoid duplicate districts

    stations.forEach(station => {
      if (station.country === country && station.region === region) {
        districts.add(station.district);
      }
    });

    const districtSelect = document.getElementById('districtSelect');
    districtSelect.innerHTML = "<option value=''>Select District</option>";
    districts.forEach(district => {
      const option = document.createElement('option');
      option.value = district;
      option.textContent = district;
      districtSelect.appendChild(option);
    });
  }

  // Function to load stations based on selected district
  function loadStations() {
    const country = document.getElementById('countrySelect').value;
    const region = document.getElementById('regionSelect').value;
    const district = document.getElementById('districtSelect').value;

    const stationsInDistrict = stations.filter(station => 
      station.country === country && 
      station.region === region && 
      station.district === district
    );

    const stationSelect = document.getElementById('stationSelect');
    stationSelect.innerHTML = "<option value=''>Select Station</option>";

    if (stationsInDistrict.length > 0) {
      stationsInDistrict.forEach(station => {
        const option = document.createElement('option');
        option.value = station.name;
        option.textContent = `${station.name} (${station.otherLines.join(", ")})`;
        stationSelect.appendChild(option);
      });
    } else {
      const option = document.createElement('option');
      option.value = '';
      option.textContent = 'No stations available';
      stationSelect.appendChild(option);
    }
  }

    // Money tracking
    var money = 0;
    function increaseMoney(amount) {
      money += amount;
      document.getElementById('info').textContent = 'Money: $' + money;
    }

    // Station and line selection
    function loadStations() {
      let stationSelect = document.getElementById('stationSelect');
      stationSelect.innerHTML = ''; // Clear previous selections

      lines.forEach((line, lineIndex) => {
        line.stops.forEach((stop, stopIndex) => {
          if (stop.locked) return; // Skip locked stations
          let option = document.createElement('option');
          option.value = `${lineIndex}-${stopIndex}`;
          option.textContent = stop.name;
          stationSelect.appendChild(option);
        });
      });

      document.getElementById('stationSelection').style.display = 'block'; // Show station selection
    }

    function selectStation() {
      const selectedValue = document.getElementById('stationSelect').value;
      const [lineIndex, stopIndex] = selectedValue.split('-').map(Number);
      const selectedStation = lines[lineIndex].stops[stopIndex];
      console.log(`Selected Station: ${selectedStation.name}`);

      // Now load available lines for the selected station
      loadLines(lineIndex, stopIndex);
    }

    function loadLines(lineIndex, stopIndex) {
      let lineSelect = document.getElementById('lineSelect');
      lineSelect.innerHTML = ''; // Clear previous selections

      // Get the relevant line based on station choice
      const line = lines[lineIndex];
      line.trains.forEach((train, index) => {
        let option = document.createElement('option');
        option.value = `${lineIndex}-${index}`;
        option.textContent = train.name;
        lineSelect.appendChild(option);
      });

      document.getElementById('lineSelection').style.display = 'block'; // Show line selection
    }

    function selectLine() {
      const selectedValue = document.getElementById('lineSelect').value;
      const [lineIndex, trainIndex] = selectedValue.split('-').map(Number);
      const selectedTrain = lines[lineIndex].trains[trainIndex];
      console.log(`Selected Line: ${selectedTrain.name}`);

      // Start the game or simulate the train
      startGame(lineIndex, trainIndex);
    }

    function startGame(lineIndex, trainIndex) {
      const line = lines[lineIndex];
      const train = line.trains[trainIndex];
      
      // Set initial train position
      const startingStation = line.stops[train.startingIndex];
      const trainMarker = L.marker(startingStation.location).addTo(map);

      increaseMoney(50); // Start with some money
      alert(`Game started! You are on train: ${train.name} starting at station: ${startingStation.name}`);
    }

    // Initialize the game by loading stations
    loadStations();

  </script>
</body>
</html>
